<!DOCTYPE html>
<html lang="bn">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Brave Search App</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f4f4f4; }
    #search-section { margin-bottom: 20px; }
    #searchInput { width: 70%; padding: 10px; font-size: 16px; }
    #searchButton { padding: 10px 20px; font-size: 16px; }
    #search-results .result-item { background: #fff; margin-bottom: 15px; padding: 15px; border-radius: 8px; }
    .result-thumbnail img { width: 100px; height: auto; }
    .result-info { margin-left: 10px; }
    .result-title { margin: 5px 0; font-size: 18px; }
    .result-description { font-size: 14px; color: #555; }
    .source-name { font-size: 12px; color: #888; }
    #pagination button { margin: 5px; padding: 8px 16px; }
    @media (max-width: 600px) {
      #searchInput { width: 100%; margin-bottom: 10px; }
      #searchButton { width: 100%; }
    }
  </style>
</head>
<body>
  <script src="scripts/protect.js"></script>

<div id="search-section">
  <input type="text" id="searchInput" placeholder="অনুসন্ধান করুন...">
  <button id="searchButton">Search</button>
</div>

<div id="search-results"></div>
<div id="pagination"></div>

<script>
// === SETTINGS ===
const API_KEY = 'BSAuysYkY4TMapNnh_zBDbHA46KcIuf'; // Replace with your real Brave API Key
const RESULTS_PER_PAGE = 10;
const COUNTRY = 'ALL'; // You can change to 'US', 'IN', etc.
const SEARCH_LANG = 'bn'; // Bengali
const UI_LANG = 'en-US'; // Interface Language

// === Bad words to filter (Bengali + English) ===
const badWords = [
  'গালি','অশ্লীল','নফরৎ','ধর্ষণ','মাদক','হিংসা','অনৈতিক','জঘন্য','সেক্স','চুদাচুদি','পর্ণ','নগ্ন','হস্তমৈথুন','পতিতা','বেলেল্লাপনা',
  'adult','porn','xxx','masturbate','escort','nude','sex','blowjob','boobs','pussy','dildo','hardcore'
];

// === Global Variables ===
let currentPage = 1;
let currentQuery = "";

// === Search Function ===
function searchResults(query, page = 1) {
  const offset = (page - 1) * RESULTS_PER_PAGE;
  const url = `https://api.search.brave.com/res/v1/web/search?q=${encodeURIComponent(query)}&count=${RESULTS_PER_PAGE}&offset=${offset}&country=${COUNTRY}&search_lang=${SEARCH_LANG}&ui_lang=${UI_LANG}&safesearch=moderate`;

  fetch(url, {
    method: 'GET',
    headers: {
      'Accept': 'application/json',
      'Accept-Encoding': 'gzip',
      'X-Subscription-Token': API_KEY
    }
  })
  .then(response => response.json())
  .then(data => {
    const results = (data.web && data.web.results) ? data.web.results : [];
    displayResults(results);
  })
  .catch(error => {
    console.error('Error fetching search results:', error);
    document.getElementById('search-results').innerHTML = '<p>ফলাফল লোড করতে সমস্যা হয়েছে।</p>';
  });
}

// === Display Results ===
function displayResults(results) {
  const searchResultsContainer = document.getElementById('search-results');
  searchResultsContainer.innerHTML = '';

  if (results.length > 0) {
    results.forEach(item => {
      if (!item.title || !item.url) return;

      let containsBadWords = badWords.some(word => 
        (item.title && item.title.toLowerCase().includes(word)) || 
        (item.description && item.description.toLowerCase().includes(word))
      );

      if (containsBadWords) return;

      const resultItem = document.createElement('div');
      resultItem.classList.add('result-item');

      const thumbnail = (item.thumbnail && item.thumbnail.url) ? item.thumbnail.url : 'https://via.placeholder.com/150';
      const siteName = new URL(item.url).hostname.replace('www.', '');

      resultItem.innerHTML = `
        <div class="result-thumbnail">
          <img src="${thumbnail}" alt="Thumbnail" onerror="this.style.display='none'">
        </div>
        <div class="result-info">
          <a href="${item.url}" target="_blank" class="result-link">
            <h3 class="result-title">${item.title}</h3>
          </a>
          <p class="result-description">${item.description || ''}</p>
          <span class="source-name">${siteName}</span>
        </div>
      `;
      searchResultsContainer.appendChild(resultItem);
    });

    updatePagination(results.length);
  } else {
    searchResultsContainer.innerHTML = '<p>কোনো ফলাফল পাওয়া যায়নি।</p>';
  }
}

// === Update Pagination ===
function updatePagination(resultsCount) {
  const paginationContainer = document.getElementById('pagination');
  paginationContainer.innerHTML = '';

  const prevButton = document.createElement('button');
  prevButton.textContent = 'পূর্ববর্তী';
  prevButton.disabled = (currentPage <= 1);
  prevButton.onclick = () => {
    if (currentPage > 1) {
      currentPage--;
      searchResults(currentQuery, currentPage);
    }
  };

  const nextButton = document.createElement('button');
  nextButton.textContent = 'পরবর্তী';
  nextButton.disabled = (resultsCount < RESULTS_PER_PAGE);
  nextButton.onclick = () => {
    currentPage++;
    searchResults(currentQuery, currentPage);
  };

  paginationContainer.appendChild(prevButton);
  paginationContainer.appendChild(nextButton);
}

// === Button and Enter Key Event ===
document.getElementById('searchButton').addEventListener('click', () => {
  const query = document.getElementById('searchInput').value.trim();
  if (query) {
    currentQuery = query;
    currentPage = 1;
    searchResults(query);
  }
});

document.getElementById('searchInput').addEventListener('keydown', (e) => {
  if (e.key === 'Enter') {
    document.getElementById('searchButton').click();
  }
});
</script>

</body>
</html>
